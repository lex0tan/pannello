<!-- Modal Nuovo / Modifica Prodotto -->
<div class="modal fade" id="skuProductModal" tabindex="-1" aria-labelledby="skuProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable modal-fullscreen-lg-down"
         style="--bs-modal-width: min(1480px, 96vw);">
        <div class="modal-content border-0 shadow-lg">

            <!-- HEADER -->
            <div class="modal-header border-0 pb-3 position-sticky top-0 bg-body" style="z-index: 2;">
                <div class="d-flex align-items-center gap-3">
                    <div class="rounded-3 d-flex align-items-center justify-content-center"
                         style="width:44px;height:44px;">
                        <i class="bi bi-box-seam fs-4"></i>
                    </div>
                    <div class="lh-sm">
                        <h5 class="modal-title d-flex align-items-center gap-2 mb-1" id="skuProductModalLabel">
                            <span>Aggiungi un prodotto</span>
                        </h5>
                        <div class="small text-muted">
                            Compila i dati essenziali. I dettagli completi li vedrai nella scheda prodotto.
                        </div>
                    </div>
                </div>

                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="border-top"></div>

            <!-- BODY -->
            <div class="modal-body">
                <form id="skuProductForm" novalidate>
                    <div class="row g-3">

                        <!-- COLONNA SINISTRA -->
                        <div class="col-12 col-lg-8">

                            <!-- DATI DI BASE -->
                            <div class="border rounded-3 p-3 mb-3 bg-light shadow-sm">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="text-uppercase small fw-semibold mb-0">
                                        Dati di base
                                    </h6>
                                    <span class="small text-muted">
                                        Campi obbligatori per identificare il prodotto
                                    </span>
                                </div>

                                <div class="row g-3">
                                    <div class="col-12 col-md-4">
                                        <label for="skuInput" class="form-label small mb-1">
                                            SKU interno <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control" id="skuInput"
                                               placeholder="Es. YAM-R3-2023-SCR" required>
                                        <div class="form-text small text-muted">
                                            Codice univoco interno che userai nel pannello e negli ordini.
                                        </div>
                                    </div>

                                    <div class="col-12 col-md-8">
                                        <label for="nameInput" class="form-label small mb-1">
                                            Nome prodotto <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control" id="nameInput"
                                               placeholder="Es. Cupolino racing Yamaha R3 2023" required>
                                        <div class="form-text small text-muted">
                                            Descrizione breve leggibile, usata per ricerche e liste.
                                        </div>
                                    </div>

                                    <div class="col-12 col-md-4">
                                        <label for="brandSelect" class="form-label small mb-1">
                                            Brand
                                        </label>
                                        <select class="form-select" id="brandSelect">
                                            <option value="0">Nessuno</option>
                                            <!-- Popola da JS -->
                                        </select>
                                        <div class="form-text small text-muted">
                                            Marca o casa produttrice del prodotto.
                                        </div>
                                    </div>

                                    <div class="col-12 col-md-4">
                                        <label for="categorySelect" class="form-label small mb-1">
                                            Categoria principale
                                        </label>
                                        <select class="form-select" id="categorySelect">
                                            <option value="0">Nessuno</option>
                                            <!-- Popola da JS -->
                                        </select>
                                        <div class="form-text small text-muted">
                                            Categoria principale del prodotto.
                                        </div>
                                    </div>

                                    <div class="col-12 col-md-4">
                                        <label for="statusSelect" class="form-label small mb-1">Stato</label>
                                        <select class="form-select" id="statusSelect">
                                            <option value="1" selected>Attivo</option>
                                            <option value="0">Disabilitato</option>
                                            <option value="2">Dismesso</option>
                                        </select>
                                    </div>

                                    <div class="col-12">
                                        <label for="tagSearchInput" class="form-label small mb-1">
                                            Tag prodotto
                                        </label>

                                        <div class="position-relative">
                                            <input type="text" class="form-control" id="tagSearchInput"
                                                   placeholder="Cerca o crea un tag... (es. promo, fragile, kit)"
                                                   autocomplete="off">

                                            <div id="tagSuggestions"
                                                 class="list-group position-absolute w-100 shadow-sm d-none"
                                                 style="z-index: 1080; max-height: 220px; overflow: auto;">
                                            </div>
                                        </div>

                                        <div class="mt-2 d-flex flex-wrap gap-2" id="selectedTags"></div>

                                        <div class="form-text small text-muted">
                                            Seleziona tag esistenti o crea un nuovo tag digitandolo e premendo Invio.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- TESTI & NOTE (usa larghezza, niente scroll “inutile”) -->
                            <div class="border rounded-3 p-3 bg-light shadow-sm">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="text-uppercase small fw-semibold mb-0">
                                        Testi & Note
                                    </h6>
                                    <span class="small text-muted">
                                        Descrizione e note interne affiancate (su schermi grandi)
                                    </span>
                                </div>

                                <div class="row g-3">
                                    <div class="col-12 col-lg-6">
                                        <label for="descriptionInput" class="form-label small mb-1">
                                            Descrizione
                                        </label>
                                        <textarea class="form-control" id="descriptionInput" rows="2"
                                                  placeholder="Compatibilità reali, criticità, info di montaggio, ecc."></textarea>
                                        <div class="form-text small text-muted">
                                            Testo operativo/descrittivo (puoi anche lasciarlo vuoto in questa fase).
                                        </div>
                                    </div>

                                    <div class="col-12 col-lg-6">
                                        <label for="internalNotesInput" class="form-label small mb-1">
                                            Note interne
                                        </label>
                                        <textarea class="form-control" id="internalNotesInput" rows="2"
                                                  placeholder="Solo per uso interno, non visibile ai clienti"></textarea>
                                        <div class="form-text small text-muted">
                                            Appunti interni: criticità, eccezioni, note di magazzino, ecc.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- COLONNA DESTRA -->
                        <div class="col-12 col-lg-4">

                            <!-- PREZZI E STOCK -->
                            <div class="border rounded-3 p-3 mb-3 bg-light shadow-sm">
                                <h6 class="text-uppercase small fw-semibold mb-3">
                                    Prezzi & Magazzino
                                </h6>

                                <div class="row g-3">
                                    <div class="col-12">
                                        <label for="sellPriceInput" class="form-label small mb-1">
                                            Prezzo vendita (€) <span class="text-danger">*</span>
                                        </label>
                                        <input type="number" step="0.01" min="0" class="form-control"
                                               id="sellPriceInput" placeholder="0.00">
                                        <div class="form-text small text-muted">
                                            Prezzo effettivo di vendita utilizzato negli ordini.
                                        </div>
                                    </div>

                                    <div class="col-6">
                                        <label for="stockInput" class="form-label small mb-1">
                                            Stock attuale
                                        </label>
                                        <input type="number" step="1" min="0" class="form-control" id="stockInput" value="0">
                                        <div class="form-text small text-muted">
                                            Quantità attuale a magazzino.
                                        </div>
                                    </div>

                                    <div class="col-6">
                                        <label for="minStockInput" class="form-label small mb-1">
                                            Min. stock
                                        </label>
                                        <input type="number" step="1" min="0" class="form-control" id="minStockInput" value="0">
                                        <div class="form-text small text-muted">
                                            Soglia per considerare il prodotto “sotto scorta”.
                                        </div>
                                    </div>

                                    <div class="col-6">
                                        <label for="weightInput" class="form-label small mb-1">
                                            Peso (g)
                                        </label>
                                        <input type="number" step="1" min="0" class="form-control" id="weightInput"
                                               placeholder="Es. 1200">
                                        <div class="form-text small text-muted">
                                            Utile per spedizioni e stime costi.
                                        </div>
                                    </div>

                                    <div class="col-6">
                                        <label for="eanInput" class="form-label small mb-1">
                                            EAN / Barcode
                                        </label>
                                        <input type="text" class="form-control" id="eanInput"
                                               placeholder="Es. 8051234567890">
                                        <div class="form-text small text-muted">
                                            Codice a barre, se disponibile.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- FORNITORE -->
                            <div class="border rounded-3 p-3 bg-light shadow-sm">
                                <h6 class="text-uppercase small fw-semibold mb-3">
                                    Fornitore
                                </h6>

                                <div class="mb-3">
                                    <label for="supplierSelect" class="form-label small mb-1">
                                        Fornitore principale
                                    </label>
                                    <select class="form-select" id="supplierSelect">
                                        <option value="0">Nessuno</option>
                                        <!-- Popola da JS -->
                                    </select>
                                    <div class="form-text small text-muted">
                                        Fornitore da cui normalmente approvvigioni questo prodotto.
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>
                </form>
            </div>

            <!-- FOOTER -->
            <div class="modal-footer border-top position-sticky bottom-0 bg-body" style="z-index: 2;">
                <div class="me-auto small text-muted d-none d-sm-block">
                    I campi contrassegnati con <span class="text-danger">*</span> sono obbligatori.
                </div>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    Annulla
                </button>
                <button type="button" class="btn btn-primary" id="skuSaveProductBtn">
                    Salva prodotto
                </button>
            </div>

        </div>
    </div>
</div>
